<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>çº¸é£æœºç§¯åˆ†è®¡ç®—å™¨</title>
    <style>
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .form-group label {
            margin-right: 10px;
        }
        .form-group input,
        .form-group select {
            margin-right: 10px;
        }
        .collapsible {
            cursor: pointer;
        }
        .collapsed {
            display: none;
        }
        .keypoint {
            color: black;
            text-decoration: underline;
            text-decoration-color: red;
        }
    </style>
    <script>

        var Product = /** @class */ (function () {
            function Product(name, points, dailyQuantity, purchase) {
                if (dailyQuantity === void 0) { dailyQuantity = 0; }
                this.name = name;
                this.points = points;
                this.purchase = purchase;
                this.dailyQuantity = dailyQuantity;
            }
            Product.prototype.generateSelectOptions = function (selected) {
                if (selected === void 0) { selected = -1; }
                if (this.purchase) {
                    return this.purchase.generateSelectOptions(this.points, selected);
                }
                else {
                    return '';
                }
            };
            Product.prototype.calculatePoints = function (quantity) {
                var points = new Points(this.name, quantity);
                points.points = Math.floor(this.points * quantity);
                points.cost = 0;
                points.updateExplain();
                return points;
            };
            return Product;
        }());
        var Purchase = /** @class */ (function () {
            function Purchase(quantity, costs) {
                this.quantity = quantity;
                this.costs = costs;
            }
            Purchase.prototype.generateSelectOptions = function (points, selected) {
                if (selected === void 0) { selected = -1; }
                var options = '<option value="0">ä¸è´­ä¹°</option>';
                for (var i = 1; i < this.costs.length; i++) {
                    var cost = this.costs[i];
                    var thisCost = cost - this.costs[i - 1];
                    var thisCostStr = "".concat(thisCost, "\u661F\u94BB");
                    if (thisCost == 0) {
                        thisCostStr = "å…è´¹";
                    }
                    if (points == 0) {
                        if (i == selected) {
                            options += "<option value=\"".concat(i, "\" selected>").concat(i, "\u6B21,").concat(thisCostStr, "</option>");
                        }
                        else {
                            options += "<option value=\"".concat(i, "\">").concat(i, "\u6B21,").concat(thisCostStr, "</option>");
                        }
                        continue;
                    }
                    var costPerPoint = thisCost / (this.quantity * points);
                    var discountStr = "";
                    if (costPerPoint < 10) {
                        discountStr = costPerPoint.toLocaleString('en-US', {
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 1
                        });
                        discountStr = "".concat(discountStr, "\u6298");
                    }
                    else if (costPerPoint == 10) {
                        discountStr = "åŸä»·";
                    }
                    else {
                        discountStr = (costPerPoint / 10).toLocaleString('en-US', {
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 1
                        });
                        discountStr = "".concat(discountStr, "\u500D");
                    }
                    if (i == selected) {
                        options += "<option value=\"".concat(i, "\" selected>").concat(i, "\u6B21,").concat(thisCostStr, ",").concat(discountStr, "</option>");
                    }
                    else {
                        options += "<option value=\"".concat(i, "\">").concat(i, "\u6B21,").concat(thisCostStr, ",").concat(discountStr, "</option>");
                    }
                }
                return options;
            };
            return Purchase;
        }());
        var ProductRune = new Product("å¢æ©æ–‡å­—", 0.1, 480, new Purchase(100, [
            0, 20, 50, 100, 180, 280, 380, 480, 630, 780, 930, 1080, 1280, 1480, 1680, 1880
        ]));
        var ProductEnergyCrystal = new Product("å……èƒ½é­”æ™¶", 3);
        var SkillCard = new Product("æŠ€èƒ½æŠ½", 10);
        var PedCard = new Product("å® ç‰©æŠ½", 15);
        var ProductEnergy = new Product("ç§˜å®èƒ½æº", 0.3, 240, new Purchase(50, [
            0, 30, 80, 160, 280, 430, 580, 730, 950, 1170, 1390, 1610, 1910, 2210, 2510, 2810
        ]));
        var ProductRiding = new Product("éª‘å® é—¨ç¥¨", 2, 25, new Purchase(5, [
            0, 30, 60, 110, 190, 310, 460, 660, 910, 1210
        ]));
        var ProductPack1 = new Product("è‡ªé€‰ç¤¼åŒ…1", 150, 0, new Purchase(1, [
            0, 1000
        ]));
        var ProductPack2 = new Product("è‡ªé€‰ç¤¼åŒ…2", 225, 0, new Purchase(1, [
            0, 1800
        ]));
        var ProductWater = new Product("æ—…å›¢æµ‡æ°´", 0, 0, new Purchase(1, [
            0, 0, 20, 70, 170, 270
        ]));
        var ProductInstance = new Product("ç§˜å¢ƒ/å‰¯æœ¬ä½“åŠ›", 0, 0, new Purchase(1, [
            0, 20, 40, 60,
        ]));
        var LevelGiftPoints = /** @class */ (function () {
            function LevelGiftPoints(pointLevel, points) {
                this.pointLevel = pointLevel;
                this.points = points;
            }
            return LevelGiftPoints;
        }());
        var Resources = /** @class */ (function () {
            function Resources(days, currentPoints, diamond, dailyCost, energy, energyPurchaseTimes, energyCrystal, rune, runePurchaseTimes, riding, ridingPurchaseTimes, skillCard, pedCard, pack1, pack2, subscriptionCard, water, instance, nightmareDiamond) {
                this.days = days;
                this.currentPoints = currentPoints;
                this.diamond = diamond;
                this.dailyCost = dailyCost;
                this.energy = energy;
                this.energyPurchaseTimes = energyPurchaseTimes;
                this.energyCrystal = energyCrystal;
                this.rune = rune;
                this.runePurchaseTimes = runePurchaseTimes;
                this.riding = riding;
                this.ridingPurchaseTimes = ridingPurchaseTimes;
                this.skillCard = skillCard;
                this.pedCard = pedCard;
                if (pack1) {
                    this.pack1 = Math.floor(days / 7);
                }
                else {
                    this.pack1 = 0;
                }
                if (pack2) {
                    this.pack2 = Math.floor(days / 7);
                }
                else {
                    this.pack2 = 0;
                }
                if (subscriptionCard) {
                    this.subscriptionCard = 100;
                }
                else {
                    this.subscriptionCard = 0;
                }
                this.water = water;
                this.instance = instance;
                this.nightmareDiamond = nightmareDiamond;
            }
            Resources.prototype.calculate = function (levelPoints) {
                var result = new Result();
                var newline = new Points("ç©ºè¡Œ");
                newline.explain = "";
                if (this.currentPoints > 0) {
                    if (this.days >= 7) {
                        var error = new Points("é”™è¯¯", 0, 0);
                        error.explain = "\u4F60\u586B\u5199\u7684\u5929\u6570 ".concat(this.days, " >= 7 \u5929\uFF0C\u8FD9\u610F\u5473\u7740\u7EB8\u98DE\u673A\u6D3B\u52A8\u8FD8\u6CA1\u5F00\u59CB\uFF0C\u56E0\u6B64\u4F60\u7684\u201C\u73B0\u6709\u79EF\u5206\u201D\u5E94\u8BE5\u4E3A0\u624D\u5BF9");
                        result.points.push(error);
                        var error2 = new Points("é”™è¯¯", 0, 0);
                        error2.explain = "è¯·æ£€æŸ¥ä½ çš„æ•°æ®åé‡æ–°è¾“å…¥å¹¶è®¡ç®—ã€‚";
                        result.points.push(error2);
                        return result;
                    }
                    var currentPoints = new Points("ç°æœ‰ç§¯åˆ†", 0, this.currentPoints);
                    currentPoints.explain = "\u73B0\u6709 ".concat(this.currentPoints, " \u79EF\u5206");
                    result.points.push(currentPoints);
                }
                if (this.days > 0) {
                    var zfjDays = Math.min(7, this.days); // æ´»åŠ¨å¤©æ•°
                    var dailyPoints = new Points("æ¯æ—¥ä»»åŠ¡ç§¯åˆ†", 0);
                    dailyPoints.points = 100 * zfjDays;
                    dailyPoints.explain = "\u6BCF\u65E5\u4EFB\u52A1 100 \u79EF\u5206 * ".concat(zfjDays, " \u5929, \u5171 ").concat(dailyPoints.points, " \u79EF\u5206");
                    result.points.push(dailyPoints);
                    if (this.pack1 > 0) {
                        var pack1Points = ProductPack1.calculatePoints(this.pack1);
                        pack1Points.cost = ProductPack1.purchase.costs[1] * this.pack1;
                        pack1Points.updateExplain();
                        result.points.push(pack1Points);
                    }
                    if (this.pack2 > 0) {
                        var pack2Points = ProductPack2.calculatePoints(this.pack2);
                        pack2Points.cost = ProductPack2.purchase.costs[1] * this.pack2;
                        pack2Points.updateExplain();
                        result.points.push(pack2Points);
                    }
                    var freeEnergyQuantity = zfjDays * ProductEnergy.dailyQuantity;
                    if (this.energyPurchaseTimes > 0) {
                        var purchaseEnergyQuantity = this.energyPurchaseTimes * zfjDays * ProductEnergy.purchase.quantity;
                        var purchaseEnergyPoints = ProductEnergy.calculatePoints(purchaseEnergyQuantity + freeEnergyQuantity);
                        purchaseEnergyPoints.cost = ProductEnergy.purchase.costs[this.energyPurchaseTimes] * zfjDays;
                        purchaseEnergyPoints.explain = "\u6BCF\u65E5".concat(purchaseEnergyPoints.name, " (\u514D\u8D39 ").concat(ProductEnergy.dailyQuantity, " \u4E2A + \u8D2D\u4E70 ").concat(ProductEnergy.purchase.quantity, " \u4E2A * ").concat(this.energyPurchaseTimes, " \u6B21) * ").concat(zfjDays, " \u5929");
                        purchaseEnergyPoints.explain += ", ".concat(purchaseEnergyQuantity + freeEnergyQuantity, " \u80FD\u91CF, \u5171 ").concat(purchaseEnergyPoints.points, " \u79EF\u5206");
                        purchaseEnergyPoints.explain += ", \u82B1\u8D39 ".concat(purchaseEnergyPoints.cost, " \u661F\u94BB");
                        result.points.push(purchaseEnergyPoints);
                    }
                    else {
                        var freeEnergyPoints = ProductEnergy.calculatePoints(freeEnergyQuantity);
                        freeEnergyPoints.explain = "\u6BCF\u65E5".concat(freeEnergyPoints.name, " \u514D\u8D39 ").concat(ProductEnergy.dailyQuantity, " * ").concat(zfjDays, " \u5929, \u5171 ").concat(freeEnergyQuantity, " \u4E2A, ").concat(freeEnergyPoints.points, " \u79EF\u5206");
                        result.points.push(freeEnergyPoints);
                    }
                    var tips = "";
                    if (this.days > 7) {
                        tips = "(å­˜åˆ°æ´»åŠ¨å¼€å¯å†ä½¿ç”¨)";
                    }
                    var freeRuneQuantity = this.days * ProductRune.dailyQuantity;
                    if (this.runePurchaseTimes > 0) {
                        var purchaseRuneQuantity = this.runePurchaseTimes * this.days * ProductRune.purchase.quantity;
                        var purchaseRunePoints = ProductRune.calculatePoints(purchaseRuneQuantity + freeRuneQuantity);
                        purchaseRunePoints.cost = ProductRune.purchase.costs[this.runePurchaseTimes] * this.days;
                        purchaseRunePoints.explain = "\u6BCF\u65E5".concat(purchaseRunePoints.name, " (\u514D\u8D39 ").concat(ProductRune.dailyQuantity, " + \u8D2D\u4E70 ").concat(ProductRune.purchase.quantity, " \u4E2A * ").concat(this.runePurchaseTimes, " \u6B21) * ").concat(this.days, " \u5929").concat(tips);
                        purchaseRunePoints.explain += ", ".concat(purchaseRuneQuantity + freeRuneQuantity, " \u5362\u6069\u6587\u5B57, \u5171 ").concat(purchaseRunePoints.points, " \u79EF\u5206");
                        purchaseRunePoints.explain += ", \u82B1\u8D39 ".concat(purchaseRunePoints.cost, " \u661F\u94BB");
                        result.points.push(purchaseRunePoints);
                    }
                    else {
                        var freeRunePoints = ProductRune.calculatePoints(freeRuneQuantity);
                        freeRunePoints.explain = "\u6BCF\u65E5".concat(freeRunePoints.name, " \u514D\u8D39 ").concat(ProductRune.dailyQuantity, " * ").concat(this.days, " \u5929").concat(tips, ", \u5171 ").concat(freeRuneQuantity, " \u4E2A, ").concat(freeRunePoints.points, " \u79EF\u5206");
                        result.points.push(freeRunePoints);
                    }
                    var freeRidingQuantity = this.days * ProductRiding.dailyQuantity;
                    if (this.ridingPurchaseTimes > 0) {
                        var purchaseRidingQuantity = this.ridingPurchaseTimes * this.days * ProductRiding.purchase.quantity;
                        var purchaseRidingPoints = ProductRiding.calculatePoints(purchaseRidingQuantity + freeRidingQuantity);
                        purchaseRidingPoints.cost = ProductRiding.purchase.costs[this.ridingPurchaseTimes] * this.days;
                        purchaseRidingPoints.explain = "\u6BCF\u65E5".concat(purchaseRidingPoints.name, " (\u514D\u8D39 ").concat(ProductRiding.dailyQuantity, " + \u8D2D\u4E70 ").concat(ProductRiding.purchase.quantity, " \u5F20 * ").concat(this.ridingPurchaseTimes, " \u6B21) * ").concat(this.days, " \u5929").concat(tips);
                        purchaseRidingPoints.explain += ", ".concat(purchaseRidingQuantity + freeRidingQuantity, " \u9A91\u5BA0\u95E8\u7968, \u5171 ").concat(purchaseRidingPoints.points, " \u79EF\u5206");
                        purchaseRidingPoints.explain += ", \u82B1\u8D39 ".concat(purchaseRidingPoints.cost, " \u661F\u94BB");
                        result.points.push(purchaseRidingPoints);
                    }
                    else {
                        var freeRidingPoints = ProductRiding.calculatePoints(freeRidingQuantity);
                        freeRidingPoints.explain = "\u6BCF\u65E5".concat(freeRidingPoints.name, " \u514D\u8D39 ").concat(ProductRiding.dailyQuantity, " * ").concat(this.days, " \u5929").concat(tips, ", \u5171 ").concat(freeRidingQuantity, " \u5F20, ").concat(freeRidingPoints.points, " \u79EF\u5206");
                        result.points.push(freeRidingPoints);
                    }
                    if (this.water > 0) {
                        var waterPoints = new Points("æ—…å›¢æµ‡æ°´", 0);
                        waterPoints.cost = ProductWater.purchase.costs[this.water] * this.days;
                        waterPoints.explain = "\u6BCF\u65E5\u65C5\u56E2\u6D47\u6C34 ".concat(this.water, " \u6B21 * ").concat(this.days, " \u5929, \u82B1\u8D39 ").concat(waterPoints.cost, " \u661F\u94BB");
                        result.points.push(waterPoints);
                    }
                    if (this.instance > 0) {
                        var instancePoints = new Points("ç§˜å¢ƒ/å‰¯æœ¬ä½“åŠ›", 0);
                        instancePoints.cost = ProductInstance.purchase.costs[this.instance] * this.days;
                        instancePoints.explain = "\u6BCF\u65E5\u79D8\u5883/\u526F\u672C \u8D2D\u4E70\u4F53\u529B ".concat(this.instance, " \u6B21 * ").concat(this.days, " \u5929, \u82B1\u8D39 ").concat(instancePoints.cost, " \u661F\u94BB");
                        result.points.push(instancePoints);
                    }
                    if (this.dailyCost !== 0) {
                        var dailyCostPoints = new Points("æ¯æ—¥å¼€é”€", 0);
                        dailyCostPoints.cost = this.dailyCost * this.days;
                        dailyCostPoints.explain = "\u6BCF\u65E5\u5F00\u9500 ".concat(this.dailyCost, " \u661F\u94BB * ").concat(this.days, " \u5929, \u82B1\u8D39 ").concat(dailyCostPoints.cost, " \u661F\u94BB");
                        result.points.push(dailyCostPoints);
                    }
                }
                if (this.skillCard > 0) {
                    result.points.push(SkillCard.calculatePoints(this.skillCard));
                }
                if (this.pedCard > 0) {
                    result.points.push(PedCard.calculatePoints(this.pedCard));
                }
                if (this.rune > 0) {
                    result.points.push(ProductRune.calculatePoints(this.rune));
                }
                if (this.riding > 0) {
                    result.points.push(ProductRiding.calculatePoints(this.riding));
                }
                if (this.energy > 0) {
                    result.points.push(ProductEnergy.calculatePoints(this.energy));
                }
                if (this.energyCrystal > 0) {
                    result.points.push(ProductEnergyCrystal.calculatePoints(this.energyCrystal));
                }
                // å†’é™©æ‰‹å†Œæ—¥å¸¸ä»»åŠ¡ä¸å‘¨ä»»åŠ¡èµ„æº
                var weeks = Math.floor(this.days / 7);
                if (weeks > 0) {
                    result.points.push(newline);
                    var weekTips = new Points("æ¯å‘¨ä»»åŠ¡æç¤º", 0);
                    weekTips.explain = "æ¯å‘¨ä»»åŠ¡ä¸åŒ…å«æœ¬å‘¨æ”¶ç›Š, å®é™…æ”¶ç›Šå¯èƒ½ä¼šæ›´å¤š";
                    result.points.push(weekTips);
                    if (this.nightmareDiamond > 0) {
                        var nightmareDiamond = new Points("æ¯å‘¨æ¢¦é­‡ç‹‚æ½®ä»»åŠ¡æ˜Ÿé’»", 0);
                        nightmareDiamond.cost = -this.nightmareDiamond * weeks;
                        nightmareDiamond.explain = "\u6BCF\u5468\u68A6\u9B47\u72C2\u6F6E\u4EFB\u52A1 ".concat(this.nightmareDiamond, " \u661F\u94BB * ").concat(weeks, " \u5468, \u5171\u83B7\u5F97 ").concat(-nightmareDiamond.cost, " \u661F\u94BB");
                        result.points.push(nightmareDiamond);
                    }
                    var handbookWeekDiamond = new Points("å†’é™©æ‰‹å†Œæ¯å‘¨ä»»åŠ¡æ˜Ÿé’»", 0);
                    handbookWeekDiamond.cost = -300 * weeks;
                    handbookWeekDiamond.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1 300 \u661F\u94BB * ".concat(weeks, " \u5468, \u5171\u83B7\u5F97 ").concat(-handbookWeekDiamond.cost, " \u661F\u94BB");
                    result.points.push(handbookWeekDiamond);
                    var handbookWeekSkillCard = new Points("å†’é™©æ‰‹å†Œæ¯å‘¨ä»»åŠ¡æŠ€èƒ½æŠ½", 3 * weeks);
                    handbookWeekSkillCard.points = SkillCard.points * handbookWeekSkillCard.quantity;
                    handbookWeekSkillCard.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1\u6280\u80FD\u62BD 3 \u5F20 * ".concat(weeks, " \u5468, \u5171 ").concat(handbookWeekSkillCard.quantity, " \u5F20, ").concat(handbookWeekSkillCard.points, " \u79EF\u5206");
                    result.points.push(handbookWeekSkillCard);
                    var handbookWeekEnergyCrystal = new Points("å†’é™©æ‰‹å†Œæ¯å‘¨ä»»åŠ¡å……èƒ½é­”æ™¶", 15 * weeks);
                    handbookWeekEnergyCrystal.points = ProductEnergyCrystal.points * handbookWeekEnergyCrystal.quantity;
                    handbookWeekEnergyCrystal.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1\u5145\u80FD\u9B54\u6676 15 \u4E2A * ".concat(weeks, " \u5468, \u5171 ").concat(handbookWeekEnergyCrystal.quantity, " \u4E2A, ").concat(handbookWeekEnergyCrystal.points, " \u79EF\u5206");
                    result.points.push(handbookWeekEnergyCrystal);
                    var handbookWeekRiding = new Points("å†’é™©æ‰‹å†Œæ¯å‘¨ä»»åŠ¡éª‘å® é—¨ç¥¨", 30 * weeks);
                    handbookWeekRiding.points = ProductRiding.points * handbookWeekRiding.quantity;
                    handbookWeekRiding.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1\u9A91\u5BA0\u95E8\u7968 30 \u5F20 * ".concat(weeks, " \u5468, \u5171 ").concat(handbookWeekRiding.quantity, " \u5F20, ").concat(handbookWeekRiding.points, " \u79EF\u5206");
                    result.points.push(handbookWeekRiding);
                }
                if (this.days > 0) {
                    result.points.push(newline);
                    var handbookDayDiamond = new Points("å†’é™©æ‰‹å†Œæ¯æ—¥ä»»åŠ¡æ˜Ÿé’»", 100 * this.days);
                    handbookDayDiamond.cost = -100 * this.days;
                    handbookDayDiamond.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1 100 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-handbookDayDiamond.cost, " \u661F\u94BB");
                    result.points.push(handbookDayDiamond);
                    var handbookDaySkillCard = new Points("å†’é™©æ‰‹å†Œæ¯æ—¥ä»»åŠ¡æŠ€èƒ½æŠ½", 1 * this.days);
                    handbookDaySkillCard.points = SkillCard.points * handbookDaySkillCard.quantity;
                    handbookDaySkillCard.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1\u6280\u80FD\u62BD 1 \u5F20 * ".concat(this.days, " \u5929, \u5171 ").concat(handbookDaySkillCard.quantity, " \u5F20, ").concat(handbookDaySkillCard.points, " \u79EF\u5206");
                    result.points.push(handbookDaySkillCard);
                    var handbookDayEnergyCrystal = new Points("å†’é™©æ‰‹å†Œæ¯æ—¥ä»»åŠ¡å……èƒ½é­”æ™¶", 3 * this.days);
                    handbookDayEnergyCrystal.points = ProductEnergyCrystal.points * handbookDayEnergyCrystal.quantity;
                    handbookDayEnergyCrystal.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1\u5145\u80FD\u9B54\u6676 3 \u4E2A * ".concat(this.days, " \u5929, \u5171 ").concat(handbookDayEnergyCrystal.quantity, " \u4E2A, ").concat(handbookDayEnergyCrystal.points, " \u79EF\u5206");
                    result.points.push(handbookDayEnergyCrystal);
                    var handbookDayRiding = new Points("å†’é™©æ‰‹å†Œæ¯æ—¥ä»»åŠ¡éª‘å® é—¨ç¥¨", 5 * this.days);
                    handbookDayRiding.points = ProductRiding.points * handbookDayRiding.quantity;
                    handbookDayRiding.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1\u9A91\u5BA0\u95E8\u7968 5 \u5F20 * ".concat(this.days, " \u5929, \u5171 ").concat(handbookDayRiding.quantity, " \u5F20, ").concat(handbookDayRiding.points, " \u79EF\u5206");
                    result.points.push(handbookDayRiding);
                    // æ¶é¾™
                    result.points.push(newline);
                    var dragonTips = new Points("æ¯æ—¥æ¶é¾™ä»»åŠ¡æç¤º", 0);
                    dragonTips.explain = "æ¯æ—¥æ¶é¾™ä»»åŠ¡æ˜¯æŒ‰æœ€ä½ä¿åº•ç®—çš„ï¼Œä¸€é”®æ·»åŠ ä½£å…µåæŒ‚æœºå³å¯è·å–";
                    result.points.push(dragonTips);
                    var dragonDiamond = new Points("æ¯æ—¥æ¶é¾™ä»»åŠ¡æ˜Ÿé’»", 50 * this.days);
                    dragonDiamond.cost = -50 * this.days;
                    dragonDiamond.explain = "\u6BCF\u65E5\u6076\u9F99\u4EFB\u52A1 50 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-dragonDiamond.cost, " \u661F\u94BB");
                    result.points.push(dragonDiamond);
                    var dragonSkillCard = new Points("æ¯æ—¥æ¶é¾™ä»»åŠ¡æŠ€èƒ½æŠ½", 1 * this.days);
                    dragonSkillCard.points = SkillCard.points * dragonSkillCard.quantity;
                    dragonSkillCard.explain = "\u6BCF\u65E5\u6076\u9F99\u4EFB\u52A1\u6280\u80FD\u62BD 1 \u5F20 * ".concat(this.days, " \u5929, \u5171 ").concat(dragonSkillCard.quantity, " \u5F20, ").concat(dragonSkillCard.points, " \u79EF\u5206");
                    result.points.push(dragonSkillCard);
                    result.points.push(newline);
                    if (this.subscriptionCard !== 0) {
                        var subscriptionCardPoints = new Points("æœˆå¡", 1);
                        subscriptionCardPoints.cost = -this.subscriptionCard * this.days;
                        subscriptionCardPoints.explain = "\u6708\u5361 \u6BCF\u65E5 ".concat(this.subscriptionCard, " \u661F\u94BB * ").concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-subscriptionCardPoints.cost, " \u661F\u94BB");
                        result.points.push(subscriptionCardPoints);
                    }
                    var freeDiamond = new Points("ç¤¼åŒ…é¡µé¢å…è´¹æ˜Ÿé’»", 0);
                    freeDiamond.cost = -50 * this.days;
                    freeDiamond.explain = "\u793C\u5305\u9875\u9762\u6BCF\u65E5\u514D\u8D39 50 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-freeDiamond.cost, " \u661F\u94BB");
                    result.points.push(freeDiamond);
                }
                // å¦‚æœç§¯åˆ†ä¸å¤Ÿï¼Œé‚£ä¹ˆå°†å‰©ä½™çš„æ˜Ÿé’»æ¢ç®—æˆç§¯åˆ†
                // è¿™é‡Œåªæ˜¯ä¸ªå ä½ï¼Œå› ä¸ºå…·ä½“è¦è¡¥å¤šå°‘æ˜Ÿé’»è¿˜éœ€è¦åœ¨ çº¸é£æœºç§¯åˆ†å¥–åŠ±ç¤¼å“ çš„ while å¾ªç¯ä¸­åŠ¨æ€è®¡ç®—
                var diamondPoints = new Points("\u5269\u4F59\u661F\u94BB", 0);
                result.points.push(diamondPoints);
                levelPoints.sort(function (a, b) { return a.pointLevel - b.pointLevel; });
                var finalLevelPoints = [];
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < levelPoints.length; j++) {
                        var item = levelPoints[j];
                        finalLevelPoints.push(new LevelGiftPoints(item.pointLevel + i * 3000, item.points));
                    }
                }
                var points = this.currentPoints;
                var taskPoints = new Points("çº¸é£æœºç§¯åˆ†å¥–åŠ±ç¤¼å“");
                result.points.push(taskPoints);
                while (true) {
                    var preIdx = finalLevelPoints.findIndex(function (item) { return item.pointLevel >= points; });
                    if (preIdx == -1) {
                        break;
                    }
                    var curIdx = finalLevelPoints.findIndex(function (item) { return item.pointLevel >= result.totalPoints().points; });
                    if (curIdx == -1) {
                        curIdx = finalLevelPoints.length;
                    }
                    if (curIdx == preIdx) {
                        var total = result.totalPoints();
                        points = total.points;
                        var pointsGap = 9000 - points;
                        if (pointsGap <= 0) {
                            break;
                        }
                        // æ¯æ¬¡æ·»åŠ  50 æ˜Ÿé’»å…‘æ¢ 5 ç§¯åˆ†ï¼Œç›´è‡³è¾¾åˆ° 9000 ç§¯åˆ†æˆ–è€…æ˜Ÿé’»ä¸å¤Ÿ
                        var remainDiamond = this.diamond - total.cost - total.income;
                        if (remainDiamond < 50) {
                            break;
                        }
                        diamondPoints.cost += 50;
                        diamondPoints.points += 5;
                        continue;
                    }
                    // è®¡ç®—ç§¯åˆ†
                    for (var i = preIdx; i < curIdx; i++) {
                        taskPoints.points += finalLevelPoints[i].points;
                    }
                    points = result.totalPoints().points;
                }
                taskPoints.explain = "\u7EB8\u98DE\u673A\u79EF\u5206\u5956\u52B1\u793C\u54C1, \u5171 ".concat(taskPoints.points, " \u79EF\u5206");
                if (diamondPoints.cost > 0) {
                    diamondPoints.explain = "\u4F7F\u7528 ".concat(diamondPoints.cost, " \u661F\u94BB\u8D2D\u4E70\u8D44\u6E90\uFF0C\u5151\u6362 ").concat(diamondPoints.points, " \u79EF\u5206");
                }
                else {
                    // ä» result.points ä¸­åˆ é™¤ diamondPoints
                    result.points = result.points.filter(function (item) { return item !== diamondPoints; });
                }
                return result;
            };
            return Resources;
        }());
        var Points = /** @class */ (function () {
            function Points(name, quantity, points, cost) {
                if (quantity === void 0) { quantity = 0; }
                if (points === void 0) { points = 0; }
                if (cost === void 0) { cost = 0; }
                this.name = name;
                this.quantity = quantity;
                this.points = points;
                this.cost = cost;
                this.updateExplain();
            }
            Points.prototype.updateExplain = function () {
                var s = "".concat(this.name, " * ").concat(this.quantity, " ");
                if (this.points !== 0) {
                    s += " \u5171 ".concat(this.points, " \u79EF\u5206");
                }
                if (this.cost > 0) {
                    s += ", \u82B1\u8D39 ".concat(this.cost, " \u661F\u94BB");
                }
                else if (this.cost < 0) {
                    s += ", \u83B7\u5F97 ".concat(-this.cost, " \u661F\u94BB");
                }
                this.explain = s;
            };
            return Points;
        }());
        var Result = /** @class */ (function () {
            function Result() {
                this.points = [];
            }
            Result.prototype.totalPoints = function () {
                var total = new TotalResult();
                this.points.forEach(function (p) {
                    total.points += p.points;
                    if (p.cost > 0) {
                        total.cost += p.cost;
                    }
                    else {
                        total.income += p.cost;
                    }
                });
                return total;
            };
            return Result;
        }());
        var TotalResult = /** @class */ (function () {
            function TotalResult() {
                this.points = 0;
                this.cost = 0;
                this.income = 0;
            }
            return TotalResult;
        }());
        var GradePoints = /** @class */ (function () {
            function GradePoints(name, points) {
                this.name = name;
                this.points = points;
            }
            return GradePoints;
        }());
        var PresetGradePoints = [
            new GradePoints("ç¬¬ä¸€æœŸ,æŠ€èƒ½è‡ªé€‰", [30, 30, 50, 50, 70, 100, 100]),
            new GradePoints("ç¬¬äºŒæœŸ,è¡¥é£è¢‹(æ”¶è·èƒ½æºæ¦‚ç‡ç¿»å€)", [30, 30, 0, 60, 0, 90, 0]),
            new GradePoints("ç¬¬ä¸‰æœŸ,å® ç‰©æ‹¼å›¾è‡ªé€‰", [20, 30, 0, 50, 0, 100, 0]),
            new GradePoints("ç¬¬å››æœŸ,æŠ€èƒ½è‡ªé€‰", [30, 30, 50, 50, 70, 100, 100]),
            new GradePoints("?ç¬¬äº”æœŸ,è’™æ˜§è§†ç•Œ(æ”¶è·å¢æ©æ¦‚ç‡ç¿»å€)", [30, 30, 0, 60, 0, 90, 0]),
            new GradePoints("?ç¬¬å…­æœŸ,å® ç‰©æ‹¼å›¾è‡ªé€‰", [20, 30, 0, 50, 0, 100, 0]),
            new GradePoints("?ç¬¬ä¸ƒæœŸ,åŠ¨æ„Ÿé—¨ç¥¨", [30, 30, 50, 50, 70, 100, 100]),
            new GradePoints("?ç¬¬å…«æœŸ,ç§˜å®è‡ªé€‰", [30, 30, 45, 60, 0, 90, 0]),
            new GradePoints("?ç¬¬ä¹æœŸ,éª‘å® è‡ªé€‰", [10, 10, 14, 14, 14, 20, 20]),
        ];
        function generateGradePointsSelectOptions(gps) {
            var options = '';
            for (var i = 0; i < gps.length; i++) {
                var gp = gps[i];
                options += "<option value=\"".concat(i, "\">").concat(gp.name, "</option>");
            }
            return options;
        }
        function fillGradePoints() {
            var gpIdx = document.getElementById("gradePoints").value;
            var gp = PresetGradePoints[gpIdx];
            var ids = ["p100", "p300", "p600", "p1000", "p1500", "p2200", "p3000"];
            for (var i = 0; i < ids.length; i++) {
                var id = ids[i];
                document.getElementById(id).value = String(gp.points[i]);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById("gradePoints").addEventListener("change", fillGradePoints);

            document.getElementById("energyPurchaseTimes").innerHTML = ProductEnergy.generateSelectOptions(4);
            document.getElementById("ridingPurchaseTimes").innerHTML = ProductRiding.generateSelectOptions(4);
            document.getElementById("runePurchaseTimes").innerHTML = ProductRune.generateSelectOptions(4);
            document.getElementById("water").innerHTML = ProductWater.generateSelectOptions(2);
            document.getElementById("instance").innerHTML = ProductInstance.generateSelectOptions(3);
            document.getElementById("gradePoints").innerHTML = generateGradePointsSelectOptions(PresetGradePoints);
            fillGradePoints();
        });
    </script>
</head>
<body>
<h1>çº¸é£æœºç§¯åˆ†è®¡ç®—å™¨</h1>
<b>æ³¨æ„ï¼š</b>æœ€ç»ˆè®¡ç®—å‡ºçš„ç§¯åˆ†æ˜¯ä½ <span class="keypoint">è‡³å°‘</span>èƒ½æ‹¿åˆ°çš„ç§¯åˆ†ã€‚<br>ç”±äºä¸»çº¿ã€æˆå°±ã€é™æ—¶æ´»åŠ¨ç­‰å¥–åŠ±è¿˜æœ‰é¢å¤–çš„ç§¯åˆ†ï¼Œæ‰€ä»¥<span class="keypoint">å®é™…ç§¯åˆ†èƒ½å¤Ÿæ›´å¤š</span>ä¸€äº›ã€‚<br><br>
<form id="pointsForm">
    <fieldset>
        <legend>å›ºå®šèµ„æº</legend>
        <label for="pet">å® ç‰©æŠ½:</label>
        <input type="number" value="0" id="pet" name="pet" required><br><br>

        <label for="skill">æŠ€èƒ½æŠ½:</label>
        <input type="number" value="0" id="skill" name="skill" required><br><br>

        <label for="energyCrystal">å……èƒ½é­”æ™¶:</label>
        <input type="number" value="0" id="energyCrystal" name="energyCrystal" required><br><br>

        <span>ä»¥ä¸‹è´­ä¹°æŠ˜æ‰£éƒ½æ˜¯æŒ‰ç…§åŸä»· 1ç§¯åˆ†/10æ˜Ÿé’» æ¢ç®—çš„, æ¨èéƒ½è´­ä¹° 4 æ¬¡</span><br><br>

        <label for="rune">å¢æ©æ–‡å­—:</label>
        <input type="number" value="0" id="rune" name="rune" required>
        <label for="runePurchaseTimes">æ¯æ—¥è´­ä¹°æ¬¡æ•°:</label>
        <select id="runePurchaseTimes" name="runePurchaseTimes" required>
        </select><br><br>

        <label for="energy">ç§˜å®èƒ½æº:</label>
        <input type="number" value="0" id="energy" name="energy" required>
        <label for="energyPurchaseTimes">æ¯æ—¥è´­ä¹°æ¬¡æ•°:</label>
        <select id="energyPurchaseTimes" name="energyPurchaseTimes" required>
        </select><br><br>

        <label for="riding">éª‘å® é—¨ç¥¨:</label>
        <input type="number" value="0" id="riding" name="riding" required>
        <label for="ridingPurchaseTimes">æ¯æ—¥è´­ä¹°æ¬¡æ•°:</label>
        <select id="ridingPurchaseTimes" name="ridingPurchaseTimes" required>
        </select><br><br>
    </fieldset>

    <fieldset>
        <legend>æ˜Ÿé’»æ”¶å…¥ä¸å¼€é”€</legend>
        <label for="diamond">ç°æœ‰æ˜Ÿé’»:</label>
        <input type="number" id="diamond" name="diamond" value="0" required>

        <input type="checkbox" id="subscriptionCard" name="subscriptionCard" value="0" required> <label for="subscriptionCard">æœ‰å°æœˆå¡</label><br><br>

        <label for="nightmareDiamond">æ¯å‘¨æ¢¦é­‡ç‹‚æ½®ä»»åŠ¡æ˜Ÿé’»å¥–åŠ±:</label>
        <input type="number" id="nightmareDiamond" name="nightmareDiamond" value="300" required><br>
        <span>300æ˜¯æ¯”è¾ƒåä¿å®ˆçš„æ•°ç›®ï¼Œä½ å¯ä»¥å‚è€ƒä½ çš„å®é™…æƒ…å†µå¡«å†™</span><br><br>

        <label for="water">æ¯æ—¥æ—…å›¢æµ‡æ°´æ¬¡æ•°</label>
        <select id="water" name="water" required></select><br><br>

        <label for="instance">æ¯æ—¥ç§˜å¢ƒ/å‰¯æœ¬ è´­ä¹°ä½“åŠ›æ¬¡æ•°</label>
        <select id="instance" name="instance" required></select><br><br>

        <span>å•†åº—æ‰“æŠ˜<span class="keypoint">é›¶é£Ÿ</span>ä¸<span class="keypoint">çªç ´çŸ³</span> 190 æ˜Ÿé’»</span><br>
        <span>å…·ä½“æ¯æ—¥æ˜Ÿé’»å¼€é”€è¯·æ ¹æ®ä½ çš„å®é™…æƒ…å†µè°ƒæ•´</span><br>
        <label for="dailyCost">å•†åº—æ˜Ÿé’»å¼€é”€:</label>
        <input type="number" id="dailyCost" name="dailyCost" required value="190"><br><br>

        <span>å¦‚æœæœ¬æœŸçš„ç¤¼åŒ…è¿˜æ²¡è´­ä¹°,<span class="keypoint">è¯·ä¹°å®Œåæ¢ç®—æˆèµ„æº</span>å†é‡æ–°è®¡ç®—.</span><br>
        <input type="checkbox" id="pack1" name="pack1" value="1" checked required>
        <label for="pack1">è´­ä¹°è‡ªé€‰ç¤¼åŒ…1(1000æ˜Ÿé’»,150ç§¯åˆ†,6.7æŠ˜)</label><br>
        <input type="checkbox" id="pack2" name="pack2" value="1" checked required>
        <label for="pack2">è´­ä¹°è‡ªé€‰ç¤¼åŒ…2(1800æ˜Ÿé’»,225ç§¯åˆ†,8æŠ˜)</label><br><br>


    </fieldset>

    <fieldset>
        <legend>çº¸é£æœºç§¯åˆ†å¥–åŠ±</legend>
        <span>çº¸é£æœºæ¯è¾¾åˆ°ä¸€å®šç§¯åˆ†å¯é¢†å–å¥–å“ï¼Œå¦‚æœè¿™äº›å¥–å“æ˜¯å® ç‰©æŠ½ã€æŠ€èƒ½æŠ½ç­‰èƒ½å¤Ÿæ¢ç®—æˆç§¯åˆ†çš„ç‰©å“ã€‚</span><br>
        <span>é‚£ä¹ˆä½ å¯ä»¥å°†å…¶å¯¹åº”çš„ç§¯åˆ†å¡«åˆ°ä¸‹é¢å¯¹åº”çš„ä½ç½®ï¼Œè¿™æ ·èƒ½å¤Ÿæ›´åŠ å‡†ç¡®åœ°è®¡ç®—ä½ çš„ç§¯åˆ†ã€‚</span><br>
        <span>è¯·æŸ¥çœ‹å…·ä½“çš„çº¸é£æœºæ´»åŠ¨ï¼Œå¹¶å°†å¥–å“æ¢ç®—æˆç›¸åº”çš„ç§¯åˆ†ã€‚(ä¸€èˆ¬æ¥è¯´ä¸‰è½®çš„å¥–å“æ˜¯ä¸€æ ·çš„)</span><br><br>
        <fieldset>
            <legend>å¥–å“ç§¯åˆ†</legend>
            <label for="p100">100ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p100" name="p100" value="0" required><br>
            <label for="p300">300ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p300" name="p300" value="0" required><br>
            <label for="p600">600ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p600" name="p600" value="0" required><br>
            <label for="p1000">1000ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p1000" name="p1000" value="0" required><br>
            <label for="p1500">1500ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p1500" name="p1500" value="0" required><br>
            <label for="p2200">2200ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p2200" name="p2200" value="0" required><br>
            <label for="p3000">3000ç§¯åˆ†å¯¹åº”å¥–å“æ¢ç®—ç§¯åˆ†</label>
            <input type="number" id="p3000" name="p3000" value="0" required><br><br>

            ğŸ‘†ä¸€é”®å¡«å…¥ç¬¬ <select id="gradePoints" name="gradePoints" required></select>æœŸå¥–å“ç§¯åˆ†<br>
            æ„Ÿè°¢ TapTapç”¨æˆ·<a href="https://www.taptap.cn/user/61215902">æ­¤å¥¶å°šæ¸©</a> æ‰€æä¾›çš„æ•°æ®ã€‚<span class="keypoint"> é—®å·"?"å¼€å¤´çš„ä¸ºé¢„æµ‹æ•°æ®</span><br>
        </fieldset><br>

        <label for="pcurrent">ç°æœ‰ç§¯åˆ†(<span class="keypoint">æ¯å®Œæˆä¸€è½®è®°å¾—åŠ 3000</span>)</label>
        <input type="number" id="pcurrent" name="pcurrent" value="0" required><br>
    </fieldset>

    <br><label for="days">å¤šå°‘å¤©åç»“æŸ:</label>
    <input type="number" id="days" name="days" value="7" required>

    <button type="button" onclick="calculatePoints()">è®¡ç®—ç§¯åˆ†</button>
</form>

<h2>ç§¯åˆ†ç»“æœ: <br></h2>
<span id="pointsResult"></span><br><br>
<span id="all_points" style="font-weight: bold;"></span><br>
<span id="cost_result" style="font-weight: bold;"></span><br>
<span id="invite"></span><br>

<script>
    function calculatePoints() {
        const diamond = parseInt(document.getElementById('diamond').value);
        const days = parseInt(document.getElementById('days').value);
        const pet = parseInt(document.getElementById('pet').value);
        const skill = parseInt(document.getElementById('skill').value);
        const rune = parseInt(document.getElementById('rune').value);
        const runePurchaseTimes = parseInt(document.getElementById('runePurchaseTimes').value);
        const energyCrystal = parseInt(document.getElementById('energyCrystal').value);
        const energy = parseInt(document.getElementById('energy').value);
        const energyPurchaseTimes = parseInt(document.getElementById('energyPurchaseTimes').value);
        const riding = parseInt(document.getElementById('riding').value);
        const ridingPurchaseTimes = parseInt(document.getElementById('ridingPurchaseTimes').value);
        const pack1 = document.getElementById('pack1').checked ? 1 : 0;
        const pack2 = document.getElementById('pack2').checked ? 1 : 0;
        const currentPoints = parseInt(document.getElementById("pcurrent").value);
        const dailyCost = parseInt(document.getElementById("dailyCost").value);
        const subscriptionCard = document.getElementById('subscriptionCard').checked ? 1 : 0;
        const water = parseInt(document.getElementById('water').value);
        const instance = parseInt(document.getElementById('instance').value);
        const nightmareDiamond = parseInt(document.getElementById('nightmareDiamond').value);

        const levelPoints = [
            {pointLevel: 100, points: parseInt(document.getElementById("p100").value)},
            {pointLevel: 300, points: parseInt(document.getElementById("p300").value)},
            {pointLevel: 600, points: parseInt(document.getElementById("p600").value)},
            {pointLevel: 1000, points: parseInt(document.getElementById("p1000").value)},
            {pointLevel: 1500, points: parseInt(document.getElementById("p1500").value)},
            {pointLevel: 2200, points: parseInt(document.getElementById("p2200").value)},
            {pointLevel: 3000, points: parseInt(document.getElementById("p3000").value)},
        ];

        let resource = new Resources(days, currentPoints, diamond, dailyCost, energy, energyPurchaseTimes , energyCrystal, rune, runePurchaseTimes, riding, ridingPurchaseTimes , skill, pet, pack1, pack2, subscriptionCard, water, instance, nightmareDiamond);

        const result = resource.calculate(levelPoints);
        if (result.totalPoints().points === 0) {
            let explain = result.points.map(p => p.explain).join('<br>');
            document.getElementById('pointsResult').innerHTML = `<p style="color: red">${explain}</p>`;
        } else {
            let explain = result.points.map(p => p.explain).join('\n');
            document.getElementById('pointsResult').innerText = explain;
            let total = result.totalPoints();
            document.getElementById('all_points').innerText = "æ€»ç§¯åˆ†ï¼š" + total.points;
            let cost = "æ€»èŠ±è´¹ï¼š" + total.cost + "æ˜Ÿé’»\n";
            if (total.income !== 0) {
                cost += "æ€»æ”¶å…¥ï¼š" + -total.income + "æ˜Ÿé’»\n";
            }
            let remainDiamond = diamond - total.cost - total.income;
            if (remainDiamond < 0) {
                cost += "æ¬ ç¼º" + (-remainDiamond) + "æ˜Ÿé’»\n";
            } else {
                cost += "å‰©ä½™" + remainDiamond + "æ˜Ÿé’»\n";
            }
            document.getElementById('cost_result').innerText = cost;
            document.getElementById('invite').innerHTML = 'å¦‚æœè¯¥å·¥å…·æœ‰å¸®åŠ©åˆ°ä½ ï¼Œå¯ä»¥è€ƒè™‘å¡«ä¸€ä¸‹æˆ‘çš„é‚€è¯·ç  <span class="keypoint">0O9MJ9O</span> ï¼Œæ„Ÿè°¢~';
        }
    }
</script>
</body>
</html>
