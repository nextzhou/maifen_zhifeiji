<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>纸飞机积分计算器</title>
    <style>
        .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .form-group label {
            margin-right: 10px;
        }
        .form-group input,
        .form-group select {
            margin-right: 10px;
        }
        .collapsible {
            cursor: pointer;
        }
        .collapsed {
            display: none;
        }
    </style>
    <script>
        var Product = /** @class */ (function () {
            function Product(name, points, dailyQuantity, purchase) {
                if (dailyQuantity === void 0) { dailyQuantity = 0; }
                this.name = name;
                this.points = points;
                this.purchase = purchase;
                this.dailyQuantity = dailyQuantity;
            }
            Product.prototype.generateSelectOptions = function (selected) {
                if (selected === void 0) { selected = -1; }
                if (this.purchase) {
                    return this.purchase.generateSelectOptions(this.points, selected);
                }
                else {
                    return '';
                }
            };
            Product.prototype.calculatePoints = function (quantity) {
                var points = new Points(this.name, quantity);
                points.points = Math.floor(this.points * quantity);
                points.cost = 0;
                points.updateExplain();
                return points;
            };
            return Product;
        }());
        var Purchase = /** @class */ (function () {
            function Purchase(quantity, costs) {
                this.quantity = quantity;
                this.costs = costs;
            }
            Purchase.prototype.generateSelectOptions = function (points, selected) {
                if (selected === void 0) { selected = -1; }
                var options = '<option value="0">不购买</option>';
                for (var i = 1; i < this.costs.length; i++) {
                    var cost = this.costs[i];
                    var thisCost = cost - this.costs[i - 1];
                    var thisCostStr = "".concat(thisCost, "\u661F\u94BB");
                    if (thisCost == 0) {
                        thisCostStr = "免费";
                    }
                    if (points == 0) {
                        if (i == selected) {
                            options += "<option value=\"".concat(i, "\" selected>").concat(i, "\u6B21,").concat(thisCostStr, "</option>");
                        }
                        else {
                            options += "<option value=\"".concat(i, "\">").concat(i, "\u6B21,").concat(thisCostStr, "</option>");
                        }
                        continue;
                    }
                    var costPerPoint = thisCost / (this.quantity * points);
                    var discountStr = "";
                    if (costPerPoint < 10) {
                        discountStr = costPerPoint.toLocaleString('en-US', {
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 1
                        });
                        discountStr = "".concat(discountStr, "\u6298");
                    }
                    else if (costPerPoint == 10) {
                        discountStr = "原价";
                    }
                    else {
                        discountStr = (costPerPoint / 10).toLocaleString('en-US', {
                            minimumFractionDigits: 0,
                            maximumFractionDigits: 1
                        });
                        discountStr = "".concat(discountStr, "\u500D");
                    }
                    if (i == selected) {
                        options += "<option value=\"".concat(i, "\" selected>").concat(i, "\u6B21,").concat(thisCostStr, ",").concat(discountStr, "</option>");
                    }
                    else {
                        options += "<option value=\"".concat(i, "\">").concat(i, "\u6B21,").concat(thisCostStr, ",").concat(discountStr, "</option>");
                    }
                }
                return options;
            };
            return Purchase;
        }());
        var ProductRune = new Product("卢恩文字", 0.1, 480, new Purchase(100, [
            0, 20, 50, 100, 180, 280, 380, 480, 630, 780, 930, 1080, 1280, 1480, 1680, 1880
        ]));
        var ProductEnergyCrystal = new Product("充能魔晶", 3);
        var SkillCard = new Product("技能抽", 10);
        var PedCard = new Product("宠物抽", 15);
        var ProductEnergy = new Product("秘宝能源", 0.3, 240, new Purchase(50, [
            0, 30, 80, 160, 280, 430, 580, 730, 950, 1170, 1390, 1610, 1910, 2210, 2510, 2810
        ]));
        var ProductRiding = new Product("骑宠门票", 2, 25, new Purchase(5, [
            0, 30, 60, 110, 190, 310, 460, 660, 910, 1210
        ]));
        var ProductPack1 = new Product("自选礼包1", 150, 0, new Purchase(1, [
            0, 1000
        ]));
        var ProductPack2 = new Product("自选礼包2", 225, 0, new Purchase(1, [
            0, 1800
        ]));
        var ProductWater = new Product("旅团浇水", 0, 0, new Purchase(1, [
            0, 0, 20, 70, 170, 270
        ]));
        var ProductInstance = new Product("秘境/副本体力", 0, 0, new Purchase(1, [
            0, 20, 40, 60,
        ]));
        var LevelGiftPoints = /** @class */ (function () {
            function LevelGiftPoints(pointLevel, points) {
                this.pointLevel = pointLevel;
                this.points = points;
            }
            return LevelGiftPoints;
        }());
        var Resources = /** @class */ (function () {
            function Resources(days, currentPoints, diamond, dailyCost, energy, energyPurchaseTimes, energyCrystal, rune, runePurchaseTimes, riding, ridingPurchaseTimes, skillCard, pedCard, pack1, pack2, subscriptionCard, water, instance, nightmareDiamond) {
                this.days = days;
                this.currentPoints = currentPoints;
                this.diamond = diamond;
                this.dailyCost = dailyCost;
                this.energy = energy;
                this.energyPurchaseTimes = energyPurchaseTimes;
                this.energyCrystal = energyCrystal;
                this.rune = rune;
                this.runePurchaseTimes = runePurchaseTimes;
                this.riding = riding;
                this.ridingPurchaseTimes = ridingPurchaseTimes;
                this.skillCard = skillCard;
                this.pedCard = pedCard;
                if (pack1) {
                    this.pack1 = Math.floor(days / 7);
                }
                else {
                    this.pack1 = 0;
                }
                if (pack2) {
                    this.pack2 = Math.floor(days / 7);
                }
                else {
                    this.pack2 = 0;
                }
                if (subscriptionCard) {
                    this.subscriptionCard = 100;
                }
                else {
                    this.subscriptionCard = 0;
                }
                this.water = water;
                this.instance = instance;
                this.nightmareDiamond = nightmareDiamond;
            }
            Resources.prototype.calculate = function (levelPoints) {
                var result = new Result();
                if (this.currentPoints > 0) {
                    var currentPoints = new Points("现有积分", 0, this.currentPoints);
                    currentPoints.explain = "\u73B0\u6709 ".concat(this.currentPoints, " \u79EF\u5206");
                    result.points.push(currentPoints);
                }
                if (this.days > 0) {
                    var zfjDays = Math.min(7, this.days); // 活动天数
                    var dailyPoints = new Points("每日任务积分", 0);
                    dailyPoints.points = 100 * zfjDays;
                    dailyPoints.explain = "\u6BCF\u65E5\u4EFB\u52A1 100 \u79EF\u5206 * ".concat(zfjDays, " \u5929, \u5171 ").concat(dailyPoints.points, " \u79EF\u5206");
                    result.points.push(dailyPoints);
                    if (this.pack1 > 0) {
                        var pack1Points = ProductPack1.calculatePoints(this.pack1);
                        pack1Points.cost = ProductPack1.purchase.costs[1] * this.pack1;
                        pack1Points.updateExplain();
                        result.points.push(pack1Points);
                    }
                    if (this.pack2 > 0) {
                        var pack2Points = ProductPack2.calculatePoints(this.pack2);
                        pack2Points.cost = ProductPack2.purchase.costs[1] * this.pack2;
                        pack2Points.updateExplain();
                        result.points.push(pack2Points);
                    }
                    var freeEnergyQuantity = zfjDays * ProductEnergy.dailyQuantity;
                    if (this.energyPurchaseTimes > 0) {
                        var purchaseEnergyQuantity = this.energyPurchaseTimes * zfjDays * ProductEnergy.purchase.quantity;
                        var purchaseEnergyPoints = ProductEnergy.calculatePoints(purchaseEnergyQuantity + freeEnergyQuantity);
                        purchaseEnergyPoints.cost = ProductEnergy.purchase.costs[this.energyPurchaseTimes] * zfjDays;
                        purchaseEnergyPoints.explain = "\u6BCF\u65E5".concat(purchaseEnergyPoints.name, " (\u514D\u8D39 ").concat(ProductEnergy.dailyQuantity, " \u4E2A + \u8D2D\u4E70 ").concat(ProductEnergy.purchase.quantity, " \u4E2A * ").concat(this.energyPurchaseTimes, " \u6B21) * ").concat(zfjDays, " \u5929");
                        purchaseEnergyPoints.explain += ", ".concat(purchaseEnergyQuantity + freeEnergyQuantity, " \u80FD\u91CF, \u5171 ").concat(purchaseEnergyPoints.points, " \u79EF\u5206");
                        purchaseEnergyPoints.explain += ", \u82B1\u8D39 ".concat(purchaseEnergyPoints.cost, " \u661F\u94BB");
                        result.points.push(purchaseEnergyPoints);
                    }
                    else {
                        var freeEnergyPoints = ProductEnergy.calculatePoints(freeEnergyQuantity);
                        freeEnergyPoints.explain = "\u6BCF\u65E5".concat(freeEnergyPoints.name, " \u514D\u8D39 ").concat(ProductEnergy.dailyQuantity, " * ").concat(zfjDays, " \u5929, \u5171 ").concat(freeEnergyQuantity, " \u4E2A, ").concat(freeEnergyPoints.points, " \u79EF\u5206");
                        result.points.push(freeEnergyPoints);
                    }
                    var tips = "";
                    if (this.days > 7) {
                        tips = "(存到活动开启再使用)";
                    }
                    var freeRuneQuantity = this.days * ProductRune.dailyQuantity;
                    if (this.runePurchaseTimes > 0) {
                        var purchaseRuneQuantity = this.runePurchaseTimes * this.days * ProductRune.purchase.quantity;
                        var purchaseRunePoints = ProductRune.calculatePoints(purchaseRuneQuantity + freeRuneQuantity);
                        purchaseRunePoints.cost = ProductRune.purchase.costs[this.runePurchaseTimes] * this.days;
                        purchaseRunePoints.explain = "\u6BCF\u65E5".concat(purchaseRunePoints.name, " (\u514D\u8D39 ").concat(ProductRune.dailyQuantity, " + \u8D2D\u4E70 ").concat(ProductRune.purchase.quantity, " \u4E2A * ").concat(this.runePurchaseTimes, " \u6B21) * ").concat(this.days, " \u5929").concat(tips);
                        purchaseRunePoints.explain += ", ".concat(purchaseRuneQuantity + freeRuneQuantity, " \u5362\u6069\u6587\u5B57, \u5171 ").concat(purchaseRunePoints.points, " \u79EF\u5206");
                        purchaseRunePoints.explain += ", \u82B1\u8D39 ".concat(purchaseRunePoints.cost, " \u661F\u94BB");
                        result.points.push(purchaseRunePoints);
                    }
                    else {
                        var freeRunePoints = ProductRune.calculatePoints(freeRuneQuantity);
                        freeRunePoints.explain = "\u6BCF\u65E5".concat(freeRunePoints.name, " \u514D\u8D39 ").concat(ProductRune.dailyQuantity, " * ").concat(this.days, " \u5929").concat(tips, ", \u5171 ").concat(freeRuneQuantity, " \u4E2A, ").concat(freeRunePoints.points, " \u79EF\u5206");
                        result.points.push(freeRunePoints);
                    }
                    var freeRidingQuantity = this.days * ProductRiding.dailyQuantity;
                    if (this.ridingPurchaseTimes > 0) {
                        var purchaseRidingQuantity = this.ridingPurchaseTimes * this.days * ProductRiding.purchase.quantity;
                        var purchaseRidingPoints = ProductRiding.calculatePoints(purchaseRidingQuantity + freeRidingQuantity);
                        purchaseRidingPoints.cost = ProductRiding.purchase.costs[this.ridingPurchaseTimes] * this.days;
                        purchaseRidingPoints.explain = "\u6BCF\u65E5".concat(purchaseRidingPoints.name, " (\u514D\u8D39 ").concat(ProductRiding.dailyQuantity, " + \u8D2D\u4E70 ").concat(ProductRiding.purchase.quantity, " \u5F20 * ").concat(this.ridingPurchaseTimes, " \u6B21) * ").concat(this.days, " \u5929").concat(tips);
                        purchaseRidingPoints.explain += ", ".concat(purchaseRidingQuantity + freeRidingQuantity, " \u9A91\u5BA0\u95E8\u7968, \u5171 ").concat(purchaseRidingPoints.points, " \u79EF\u5206");
                        purchaseRidingPoints.explain += ", \u82B1\u8D39 ".concat(purchaseRidingPoints.cost, " \u661F\u94BB");
                        result.points.push(purchaseRidingPoints);
                    }
                    else {
                        var freeRidingPoints = ProductRiding.calculatePoints(freeRidingQuantity);
                        freeRidingPoints.explain = "\u6BCF\u65E5".concat(freeRidingPoints.name, " \u514D\u8D39 ").concat(ProductRiding.dailyQuantity, " * ").concat(this.days, " \u5929").concat(tips, ", \u5171 ").concat(freeRidingQuantity, " \u5F20, ").concat(freeRidingPoints.points, " \u79EF\u5206");
                        result.points.push(freeRidingPoints);
                    }
                    if (this.water > 0) {
                        var waterPoints = new Points("旅团浇水", 0);
                        waterPoints.cost = ProductWater.purchase.costs[this.water] * this.days;
                        waterPoints.explain = "\u6BCF\u65E5\u65C5\u56E2\u6D47\u6C34 ".concat(this.water, " \u6B21 * ").concat(this.days, " \u5929, \u82B1\u8D39 ").concat(waterPoints.cost, " \u661F\u94BB");
                        result.points.push(waterPoints);
                    }
                    if (this.instance > 0) {
                        var instancePoints = new Points("秘境/副本体力", 0);
                        instancePoints.cost = ProductInstance.purchase.costs[this.instance] * this.days;
                        instancePoints.explain = "\u6BCF\u65E5\u79D8\u5883/\u526F\u672C \u8D2D\u4E70\u4F53\u529B ".concat(this.instance, " \u6B21 * ").concat(this.days, " \u5929, \u82B1\u8D39 ").concat(instancePoints.cost, " \u661F\u94BB");
                        result.points.push(instancePoints);
                    }
                    if (this.dailyCost !== 0) {
                        var dailyCostPoints = new Points("每日开销", 0);
                        dailyCostPoints.cost = this.dailyCost * this.days;
                        dailyCostPoints.explain = "\u6BCF\u65E5\u5F00\u9500 ".concat(this.dailyCost, " \u661F\u94BB * ").concat(this.days, " \u5929, \u82B1\u8D39 ").concat(dailyCostPoints.cost, " \u661F\u94BB");
                        result.points.push(dailyCostPoints);
                    }
                }
                if (this.skillCard > 0) {
                    result.points.push(SkillCard.calculatePoints(this.skillCard));
                }
                if (this.pedCard > 0) {
                    result.points.push(PedCard.calculatePoints(this.pedCard));
                }
                if (this.rune > 0) {
                    result.points.push(ProductRune.calculatePoints(this.rune));
                }
                if (this.riding > 0) {
                    result.points.push(ProductRiding.calculatePoints(this.riding));
                }
                if (this.energy > 0) {
                    result.points.push(ProductEnergy.calculatePoints(this.energy));
                }
                if (this.energyCrystal > 0) {
                    result.points.push(ProductEnergyCrystal.calculatePoints(this.energyCrystal));
                }
                // 冒险手册日常任务与周任务资源
                var weeks = Math.floor(this.days / 7);
                if (weeks > 0) {
                    var weekTips = new Points("每周任务提示", 0);
                    weekTips.explain = "\n每周任务不包含本周收益, 实际收益可能会更多";
                    result.points.push(weekTips);
                    if (this.nightmareDiamond > 0) {
                        var nightmareDiamond = new Points("每周噩梦任务星钻", 0);
                        nightmareDiamond.cost = -this.nightmareDiamond * weeks;
                        nightmareDiamond.explain = "\u6BCF\u5468\u5669\u68A6\u4EFB\u52A1 ".concat(this.nightmareDiamond, " \u661F\u94BB * ").concat(weeks, " \u5468, \u5171\u83B7\u5F97 ").concat(-nightmareDiamond.cost, " \u661F\u94BB");
                        result.points.push(nightmareDiamond);
                    }
                    var handbookWeekDiamond = new Points("冒险手册每周任务星钻", 0);
                    handbookWeekDiamond.cost = -300 * weeks;
                    handbookWeekDiamond.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1 300 \u661F\u94BB * ".concat(weeks, " \u5468, \u5171\u83B7\u5F97 ").concat(-handbookWeekDiamond.cost, " \u661F\u94BB");
                    result.points.push(handbookWeekDiamond);
                    var handbookWeekSkillCard = new Points("冒险手册每周任务技能抽", 3 * weeks);
                    handbookWeekSkillCard.points = SkillCard.points * handbookWeekSkillCard.quantity;
                    handbookWeekSkillCard.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1\u6280\u80FD\u62BD 3 \u5F20 * ".concat(weeks, " \u5468, \u5171 ").concat(handbookWeekSkillCard.quantity, " \u5F20, ").concat(handbookWeekSkillCard.points, " \u79EF\u5206");
                    result.points.push(handbookWeekSkillCard);
                    var handbookWeekEnergyCrystal = new Points("冒险手册每周任务充能魔晶", 15 * weeks);
                    handbookWeekEnergyCrystal.points = ProductEnergyCrystal.points * handbookWeekEnergyCrystal.quantity;
                    handbookWeekEnergyCrystal.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1\u5145\u80FD\u9B54\u6676 15 \u4E2A * ".concat(weeks, " \u5468, \u5171 ").concat(handbookWeekEnergyCrystal.quantity, " \u4E2A, ").concat(handbookWeekEnergyCrystal.points, " \u79EF\u5206");
                    result.points.push(handbookWeekEnergyCrystal);
                    var handbookWeekRiding = new Points("冒险手册每周任务骑宠门票", 30 * weeks);
                    handbookWeekRiding.points = ProductRiding.points * handbookWeekRiding.quantity;
                    handbookWeekRiding.explain = "\u5192\u9669\u624B\u518C\u6BCF\u5468\u4EFB\u52A1\u9A91\u5BA0\u95E8\u7968 30 \u5F20 * ".concat(weeks, " \u5468, \u5171 ").concat(handbookWeekRiding.quantity, " \u5F20, ").concat(handbookWeekRiding.points, " \u79EF\u5206");
                    result.points.push(handbookWeekRiding);
                }
                if (this.days > 0) {
                    var handbookDayDiamond = new Points("冒险手册每日任务星钻", 100 * this.days);
                    handbookDayDiamond.cost = -100 * this.days;
                    handbookDayDiamond.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1 100 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-handbookDayDiamond.cost, " \u661F\u94BB");
                    result.points.push(handbookDayDiamond);
                    var handbookDaySkillCard = new Points("冒险手册每日任务技能抽", 1 * this.days);
                    handbookDaySkillCard.points = SkillCard.points * handbookDaySkillCard.quantity;
                    handbookDaySkillCard.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1\u6280\u80FD\u62BD 1 \u5F20 * ".concat(this.days, " \u5929, \u5171 ").concat(handbookDaySkillCard.quantity, " \u5F20, ").concat(handbookDaySkillCard.points, " \u79EF\u5206");
                    result.points.push(handbookDaySkillCard);
                    var handbookDayEnergyCrystal = new Points("冒险手册每日任务充能魔晶", 3 * this.days);
                    handbookDayEnergyCrystal.points = ProductEnergyCrystal.points * handbookDayEnergyCrystal.quantity;
                    handbookDayEnergyCrystal.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1\u5145\u80FD\u9B54\u6676 3 \u4E2A * ".concat(this.days, " \u5929, \u5171 ").concat(handbookDayEnergyCrystal.quantity, " \u4E2A, ").concat(handbookDayEnergyCrystal.points, " \u79EF\u5206");
                    result.points.push(handbookDayEnergyCrystal);
                    var handbookDayRiding = new Points("冒险手册每日任务骑宠门票", 5 * this.days);
                    handbookDayRiding.points = ProductRiding.points * handbookDayRiding.quantity;
                    handbookDayRiding.explain = "\u5192\u9669\u624B\u518C\u6BCF\u65E5\u4EFB\u52A1\u9A91\u5BA0\u95E8\u7968 5 \u5F20 * ".concat(this.days, " \u5929, \u5171 ").concat(handbookDayRiding.quantity, " \u5F20, ").concat(handbookDayRiding.points, " \u79EF\u5206");
                    result.points.push(handbookDayRiding);
                    // 恶龙
                    var dragonTips = new Points("每日恶龙任务提示", 0);
                    dragonTips.explain = "\n每日恶龙任务是按最低保底算的，一键添加佣兵后挂机即可获取";
                    result.points.push(dragonTips);
                    var dragonDiamond = new Points("每日恶龙任务星钻", 50 * this.days);
                    dragonDiamond.cost = -50 * this.days;
                    dragonDiamond.explain = "\u6BCF\u65E5\u6076\u9F99\u4EFB\u52A1 50 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-dragonDiamond.cost, " \u661F\u94BB");
                    result.points.push(dragonDiamond);
                    var dragonSkillCard = new Points("每日恶龙任务技能抽", 1 * this.days);
                    dragonSkillCard.points = SkillCard.points * dragonSkillCard.quantity;
                    dragonSkillCard.explain = "\u6BCF\u65E5\u6076\u9F99\u4EFB\u52A1\u6280\u80FD\u62BD 1 \u5F20 * ".concat(this.days, " \u5929, \u5171 ").concat(dragonSkillCard.quantity, " \u5F20, ").concat(dragonSkillCard.points, " \u79EF\u5206");
                    result.points.push(dragonSkillCard);
                    if (this.subscriptionCard !== 0) {
                        var subscriptionCardPoints = new Points("月卡", 1);
                        subscriptionCardPoints.cost = -this.subscriptionCard * this.days;
                        subscriptionCardPoints.explain = "\n\u6708\u5361 \u6BCF\u65E5 ".concat(this.subscriptionCard, " \u661F\u94BB * ").concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-subscriptionCardPoints.cost, " \u661F\u94BB");
                        result.points.push(subscriptionCardPoints);
                    }
                    var shareDiamond = new Points("邀请福利分享", 0);
                    shareDiamond.cost = -30 * this.days;
                    shareDiamond.explain = "\u9080\u8BF7\u798F\u5229\u9875\u9762\u6BCF\u65E5\u5206\u4EAB 30 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-shareDiamond.cost, " \u661F\u94BB");
                    result.points.push(shareDiamond);
                    var packDiamond = new Points("开服特惠", 0);
                    packDiamond.cost = -10 * this.days;
                    packDiamond.explain = "\u5F00\u670D\u7279\u60E0\u9875\u9762\u53F3\u4E0A\u89D2\u6BCF\u65E5 10 \u661F\u94BB * ".concat(this.days, " \u5929, \u5171\u83B7\u5F97 ").concat(-packDiamond.cost, " \u661F\u94BB");
                    result.points.push(packDiamond);
                }
                // 如果积分不够，那么将剩余的星钻换算成积分
                // 这里只是个占位，因为具体要补多少星钻还需要在 纸飞机积分奖励礼品 的 while 循环中动态计算
                var diamondPoints = new Points("\u5269\u4F59\u661F\u94BB", 0);
                result.points.push(diamondPoints);
                levelPoints.sort(function (a, b) { return a.pointLevel - b.pointLevel; });
                var finalLevelPoints = [];
                for (var i = 0; i < 3; i++) {
                    for (var j = 0; j < levelPoints.length; j++) {
                        var item = levelPoints[j];
                        finalLevelPoints.push(new LevelGiftPoints(item.pointLevel + i * 3000, item.points));
                    }
                }
                var points = this.currentPoints;
                var taskPoints = new Points("纸飞机积分奖励礼品");
                result.points.push(taskPoints);
                while (true) {
                    var preIdx = finalLevelPoints.findIndex(function (item) { return item.pointLevel >= points; });
                    if (preIdx == -1) {
                        break;
                    }
                    var curIdx = finalLevelPoints.findIndex(function (item) { return item.pointLevel >= result.totalPoints().points; });
                    if (curIdx == -1) {
                        curIdx = finalLevelPoints.length;
                    }
                    if (curIdx == preIdx) {
                        var total = result.totalPoints();
                        points = total.points;
                        var pointsGap = 9000 - points;
                        if (pointsGap <= 0) {
                            break;
                        }
                        // 每次添加 50 星钻兑换 5 积分，直至达到 9000 积分或者星钻不够
                        var remainDiamond = this.diamond - total.cost - total.income;
                        if (remainDiamond < 50) {
                            break;
                        }
                        diamondPoints.cost += 50;
                        diamondPoints.points += 5;
                        continue;
                    }
                    // 计算积分
                    for (var i = preIdx; i < curIdx; i++) {
                        taskPoints.points += finalLevelPoints[i].points;
                    }
                    points = result.totalPoints().points;
                }
                taskPoints.explain = "\u7EB8\u98DE\u673A\u79EF\u5206\u5956\u52B1\u793C\u54C1, \u5171 ".concat(taskPoints.points, " \u79EF\u5206");
                if (diamondPoints.cost > 0) {
                    diamondPoints.explain = "\u4F7F\u7528 ".concat(diamondPoints.cost, " \u661F\u94BB\u8D2D\u4E70\u8D44\u6E90\uFF0C\u5151\u6362 ").concat(diamondPoints.points, " \u79EF\u5206");
                }
                else {
                    // 从 result.points 中删除 diamondPoints
                    result.points = result.points.filter(function (item) { return item !== diamondPoints; });
                }
                return result;
            };
            return Resources;
        }());
        var Points = /** @class */ (function () {
            function Points(name, quantity, points, cost) {
                if (quantity === void 0) { quantity = 0; }
                if (points === void 0) { points = 0; }
                if (cost === void 0) { cost = 0; }
                this.name = name;
                this.quantity = quantity;
                this.points = points;
                this.cost = cost;
                this.updateExplain();
            }
            Points.prototype.updateExplain = function () {
                var s = "".concat(this.name, " * ").concat(this.quantity, " ");
                if (this.points !== 0) {
                    s += " \u5171 ".concat(this.points, " \u79EF\u5206");
                }
                if (this.cost > 0) {
                    s += ", \u82B1\u8D39 ".concat(this.cost, " \u661F\u94BB");
                }
                else if (this.cost < 0) {
                    s += ", \u83B7\u5F97 ".concat(-this.cost, " \u661F\u94BB");
                }
                this.explain = s;
            };
            return Points;
        }());
        var Result = /** @class */ (function () {
            function Result() {
                this.points = [];
            }
            Result.prototype.totalPoints = function () {
                var total = new TotalResult();
                this.points.forEach(function (p) {
                    total.points += p.points;
                    if (p.cost > 0) {
                        total.cost += p.cost;
                    }
                    else {
                        total.income += p.cost;
                    }
                });
                return total;
            };
            return Result;
        }());
        var TotalResult = /** @class */ (function () {
            function TotalResult() {
                this.points = 0;
                this.cost = 0;
                this.income = 0;
            }
            return TotalResult;
        }());

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById("energyPurchaseTimes").innerHTML = ProductEnergy.generateSelectOptions(3);
            document.getElementById("ridingPurchaseTimes").innerHTML = ProductRiding.generateSelectOptions(3);
            document.getElementById("runePurchaseTimes").innerHTML = ProductRune.generateSelectOptions(3);
            document.getElementById("water").innerHTML = ProductWater.generateSelectOptions(2);
            document.getElementById("instance").innerHTML = ProductInstance.generateSelectOptions(3);
        });
    </script>
</head>
<body>
<h1>纸飞机积分计算器</h1>

<form id="pointsForm">
    <fieldset>
        <legend>固定资源</legend>
        <label for="pet">宠物抽:</label>
        <input type="number" value="0" id="pet" name="pet" required><br><br>

        <label for="skill">技能抽:</label>
        <input type="number" value="0" id="skill" name="skill" required><br><br>

        <label for="energyCrystal">能源结晶:</label>
        <input type="number" value="0" id="energyCrystal" name="energyCrystal" required><br><br>

        <span>以下购买折扣都是按照原价 1积分/10星钻 换算的, 推荐都购买 3 次, 积分不够可以买 4 次</span><br><br>

        <label for="rune">卢恩文字:</label>
        <input type="number" value="0" id="rune" name="rune" required>
        <label for="runePurchaseTimes">每日购买次数:</label>
        <select id="runePurchaseTimes" name="runePurchaseTimes" required>
        </select><br><br>

        <label for="energy">秘宝能源:</label>
        <input type="number" value="0" id="energy" name="energy" required>
        <label for="energyPurchaseTimes">每日购买次数:</label>
        <select id="energyPurchaseTimes" name="energyPurchaseTimes" required>
        </select><br><br>

        <label for="riding">骑宠门票:</label>
        <input type="number" value="0" id="riding" name="riding" required>
        <label for="ridingPurchaseTimes">每日购买次数:</label>
        <select id="ridingPurchaseTimes" name="ridingPurchaseTimes" required>
        </select><br><br>
    </fieldset>

    <fieldset>
        <legend>星钻收入与开销</legend>
        <label for="diamond">现有星钻:</label>
        <input type="number" id="diamond" name="diamond" value="0" required>

        <input type="checkbox" id="subscriptionCard" name="subscriptionCard" value="0" required> <label for="subscriptionCard">有小月卡</label><br><br>

        <label for="nightmareDiamond">每周噩梦任务星钻奖励:</label>
        <input type="number" id="nightmareDiamond" name="nightmareDiamond" value="300" required><br>
        <span>300是比较偏保守的数目，你可以参考你的实际情况填写</span><br><br>

        <label for="water">每日旅团浇水次数</label>
        <select id="water" name="water" required></select><br><br>

        <label for="instance">每日秘境/副本 购买体力次数</label>
        <select id="instance" name="instance" required></select><br><br>

        <span>商店打折零食与突破石 190 星钻</span><br>
        <span>具体每日星钻开销请根据你的实际情况调整</span><br>
        <label for="dailyCost">商店星钻开销:</label>
        <input type="number" id="dailyCost" name="dailyCost" required value="190"><br><br>

        <span>如果本期的礼包还没购买,请买完后换算成资源再重新计算.</span><br>
        <input type="checkbox" id="pack1" name="pack1" value="1" checked required>
        <label for="pack1">购买自选礼包1(1000星钻,150积分,6.7折)</label><br>
        <input type="checkbox" id="pack2" name="pack2" value="1" checked required>
        <label for="pack2">购买自选礼包2(1800星钻,225积分,8折)</label><br><br>


    </fieldset>

    <fieldset>
        <legend>纸飞机积分奖励</legend>
        <span>纸飞机每达到一定积分可领取奖品，如果这些奖品是宠物抽、技能抽等能够换算成积分的物品。</span><br>
        <span>那么你可以将其对应的积分填到下面对应的位置，这样能够更加准确地计算你的积分。</span><br>
        <span>请查看具体的纸飞机活动，并将奖品换算成相应的积分。(一般来说三轮的奖品是一样的)</span><br><br>
        <label for="p100">100积分对应奖品换算积分</label>
        <input type="number" id="p100" name="p100" value="0" required><br>
        <label for="p300">300积分对应奖品换算积分</label>
        <input type="number" id="p300" name="p300" value="0" required><br>
        <label for="p600">600积分对应奖品换算积分</label>
        <input type="number" id="p600" name="p600" value="0" required><br>
        <label for="p1000">1000积分对应奖品换算积分</label>
        <input type="number" id="p1000" name="p1000" value="0" required><br>
        <label for="p1500">1500积分对应奖品换算积分</label>
        <input type="number" id="p1500" name="p1500" value="0" required><br>
        <label for="p2200">2200积分对应奖品换算积分</label>
        <input type="number" id="p2200" name="p2200" value="0" required><br>
        <label for="p3000">3000积分对应奖品换算积分</label>
        <input type="number" id="p3000" name="p3000" value="0" required><br><br>

        <label for="pcurrent">现有积分(每完成一轮记得加3000)</label>
        <input type="number" id="pcurrent" name="pcurrent" value="0" required><br>
    </fieldset>

    <br><label for="days">多少天后结束:</label>
    <input type="number" id="days" name="days" value="7" required>

    <button type="button" onclick="calculatePoints()">计算积分</button>
</form>

<h2>积分结果: <br></h2>
<span id="pointsResult"></span><br><br>
<span id="all_points" style="font-weight: bold;"></span><br>
<span id="cost_result" style="font-weight: bold;"></span><br>

<script>


    function calculatePoints() {
        const diamond = parseInt(document.getElementById('diamond').value);
        const days = parseInt(document.getElementById('days').value);
        const pet = parseInt(document.getElementById('pet').value);
        const skill = parseInt(document.getElementById('skill').value);
        const rune = parseInt(document.getElementById('rune').value);
        const runePurchaseTimes = parseInt(document.getElementById('runePurchaseTimes').value);
        const energyCrystal = parseInt(document.getElementById('energyCrystal').value);
        const energy = parseInt(document.getElementById('energy').value);
        const energyPurchaseTimes = parseInt(document.getElementById('energyPurchaseTimes').value);
        const riding = parseInt(document.getElementById('riding').value);
        const ridingPurchaseTimes = parseInt(document.getElementById('ridingPurchaseTimes').value);
        const pack1 = document.getElementById('pack1').checked ? 1 : 0;
        const pack2 = document.getElementById('pack2').checked ? 1 : 0;
        const currentPoints = parseInt(document.getElementById("pcurrent").value);
        const dailyCost = parseInt(document.getElementById("dailyCost").value);
        const subscriptionCard = document.getElementById('subscriptionCard').checked ? 1 : 0;
        const water = parseInt(document.getElementById('water').value);
        const instance = parseInt(document.getElementById('instance').value);
        const nightmareDiamond = parseInt(document.getElementById('nightmareDiamond').value);

        const levelPoints = [
            {pointLevel: 100, points: parseInt(document.getElementById("p100").value)},
            {pointLevel: 300, points: parseInt(document.getElementById("p300").value)},
            {pointLevel: 600, points: parseInt(document.getElementById("p600").value)},
            {pointLevel: 1000, points: parseInt(document.getElementById("p1000").value)},
            {pointLevel: 1500, points: parseInt(document.getElementById("p1500").value)},
            {pointLevel: 2200, points: parseInt(document.getElementById("p2200").value)},
            {pointLevel: 3000, points: parseInt(document.getElementById("p3000").value)},
        ];

        let resource = new Resources(days, currentPoints, diamond, dailyCost, energy, energyPurchaseTimes , energyCrystal, rune, runePurchaseTimes, riding, ridingPurchaseTimes , skill, pet, pack1, pack2, subscriptionCard, water, instance, nightmareDiamond);

        const result = resource.calculate(levelPoints);
        document.getElementById('pointsResult').innerText = result.points.map(p => p.explain).join('\n');
        let total = result.totalPoints();
        document.getElementById('all_points').innerText = "总积分：" + total.points;
        let cost = "总花费：" + total.cost + "星钻\n";
        if (total.income !== 0) {
            cost += "总收入：" + -total.income + "星钻\n";
        }
        let remainDiamond = diamond - total.cost - total.income;
        if (remainDiamond < 0) {
            cost += "欠缺" + (-remainDiamond) + "星钻\n";
        } else {
            cost += "剩余" + remainDiamond + "星钻\n";
        }
        document.getElementById('cost_result').innerText = cost;
    }
</script>
</body>
</html>
